export _chromium_conf=(
    -Dgoogle_api_key=AIzaSyBGpe01okUSW2GQDIgLovY23Mj1RKzzOOY
    -Dgoogle_default_client_id=1006183841565.apps.googleusercontent.com
    -Dgoogle_default_client_secret=XN6oYWBv7O7w_heXB8TVuldr
    -Dwerror=
    -Dclang=0
    -Dpython_ver=2.7
    -Dlinux_link_gsettings=1
    -Dlinux_link_libpci=$([ "${CROSS:-$ARCH}" = "amd64" ] && echo 1 || echo 0 )
    -Dlinux_link_libspeechd=1
    -Dlinux_link_pulseaudio=1
    -Dlinux_strip_binary=1
    -Dlinux_use_bundled_binutils=0
    -Dlinux_use_bundled_gold=0
    -Dlinux_use_gold_flags=1
    -Dicu_use_data_file_flag=1
    -Dlogging_like_official_build=1
    -Dtracing_like_official_build=1
    -Dfieldtrial_testing_like_official_build=1
    -Drelease_extra_cflags="${CPPFLAGS} ${CFLAGS}"
    -Drelease_extra_ldflags="${LDFLAGS}"
    -Dlibspeechd_h_prefix=speech-dispatcher/
    -Dffmpeg_branding=Chrome
    -Dproprietary_codecs=1
    -Duse_gnome_keyring=0
    -Duse_system_bzip2=1
    -Duse_system_flac=1
    -Duse_system_ffmpeg=0
    -Duse_system_harfbuzz=1
    -Duse_system_icu=0
    -Duse_system_libevent=1
    -Duse_system_libjpeg=1
    -Duse_system_libpng=1
    -Duse_system_libvpx=1
    -Duse_system_libxml=0
    -Duse_system_snappy=1
    -Duse_system_xdg_utils=1
    -Duse_system_yasm=$([ "${CROSS:-$ARCH}" = "amd64" ] && echo 1 || echo 0 )
    -Duse_system_zlib=0
    -Dusb_ids_path=/usr/share/hwdata/usb.ids
    -Duse_mojo=0
    -Duse_gconf=0
    -Duse_sysroot=0
    -Denable_widevine=1
    -Ddisable_fatal_linker_warnings=1
    -Denable_hangout_services_extension=1
    -Ddisable_glibc=1)

if [[ "${CROSS:-$ARCH}" = "armel" ]]; then
    _chromium_conf+=(-Ddisable_newlib_untar=1 
    -Ddisable_sse2=1
    -Dtarget_arch=arm
    -Darmv7=1
    -Darm_neon=1
    -Darm_fpu=neon
    -Dlinux_use_tcmalloc=0
    -Ddisable_nacl=1
    -Dv8_use_arm_eabi_hardfloat=true
    -Darm_float_abi=hard)
fi

if [[ "${CROSS:-$ARCH}" = "arm64" ]]; then
    _chromium_conf+=(
    -Dtarget_arch=arm64
    -Darm_neon=1
    -Darm_fpu=neon
    -Duse_allocator=none
    -Ddisable_newlib_untar=1
    -Ddisable_sse2=1
    -Dlinux_use_tcmalloc=0
    -Ddisable_nacl=1)
fi

build/linux/unbundle/replace_gyp_files.py "${_chromium_conf[@]}"
build/gyp_chromium --depth=. "${_chromium_conf[@]}"

# Enable verbose build with -v.
ninja -v -C out/Release chrome chrome_sandbox chromedriver

install -D out/Release/chrome "$PKGDIR"/usr/lib/chromium/chromium

install -Dm4755 out/Release/chrome_sandbox \
    "$PKGDIR"/usr/lib/chromium/chrome-sandbox
install -D out/Release/chromedriver \
    "$PKGDIR"/usr/lib/chromium/chromedriver
cp out/Release/{*.pak,*.bin,libffmpegsumo.so,libwidevinecdmadapter.so} \
    "$PKGDIR"/usr/lib/chromium/

cp -a out/Release/locales "$PKGDIR"/usr/lib/chromium/

install -Dm644 out/Release/chrome.1 "$PKGDIR"/usr/share/man/man1/chromium.1

for size in 22 24 48 64 128 256; do
    install -Dm644 chrome/app/theme/chromium/product_logo_$size.png \
        "$PKGDIR"/usr/share/icons/hicolor/${size}x${size}/apps/chromium.png
  done

for size in 16 32; do
    install -Dm644 chrome/app/theme/default_100_percent/chromium/product_logo_$size.png \
        "$PKGDIR"/usr/share/icons/hicolor/${size}x${size}/apps/chromium.png
done

[ "$ARCH" = "amd64" ] && cp out/Release/nacl_helper{,_bootstrap} out/Release/nacl_irt_*.nexe \
    "$PKGDIR"/usr/lib/chromium/

ln -s /usr/lib/chromium/chromedriver "$PKGDIR"/usr/bin/chromedriver
install -Dm644 out/Release/icudtl.dat "$PKGDIR"/usr/lib/chromium/icudtl.dat

pushd chromium-launcher-3
make PREFIX=/usr
make install DESTDIR="$PKGDIR" PREFIX=/usr
popd

pushd "$PKGDIR"/usr/lib/chromium
popd
