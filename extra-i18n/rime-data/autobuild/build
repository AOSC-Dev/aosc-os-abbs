cp "$SRCDIR"/autobuild/aosc-schema-bundle.conf "$SRCDIR"

abinfo "Adding official schema name to package_list"
package_list=()
source ./preset-packages.conf
source ./extra-packages.conf


for ((i=0; i<${#package_list[@]}; i++)); do
	package_list[$i]=rime/"${package_list[$i]}"
done

abinfo "Adding unofficial schema name to package_list"
source ./aosc-schema-bundle.conf

abinfo "Cloning schema..."
for i in ${package_list[@]}; do
        abinfo "Cloning $i to package/$owner..."
        owner=$(echo $i | cut -d '/' -f1)
        repo=$(echo $i | cut -d '/' -f2)
        git clone https://github.com/$owner/rime-$repo.git package/$owner/$repo
        cd package/$owner/$repo
        rev=${repo//\-/_}
        commit=$(eval echo \$${rev^^}_REV)
	abinfo "$commit"
        git checkout $commit
        cd $SRCDIR
done

abinfo "Building schema..."
make all-bin

abinfo "Installing schema to $PKGDIR..."
make DESTDIR="$PKGDIR" install 
