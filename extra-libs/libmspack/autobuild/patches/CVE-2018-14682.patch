From 4fd9ccaa54e1aebde1e4b95fb0163b699fd7bcc8 Mon Sep 17 00:00:00 2001
From: Stuart Caie <kyzer@cabextract.org.uk>
Date: Tue, 6 Feb 2018 23:17:30 +0000
Subject: [PATCH] Fix off-by-one error in chmd TOLOWER() fallback

---
 ChangeLog     | 5 +++++
 mspack/chmd.c | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

#diff --git a/ChangeLog b/ChangeLog
#index 44cf81a..74354ac 100644
#--- a/ChangeLog
#+++ b/ChangeLog
#@@ -1,3 +1,8 @@
#+2018-02-06  Stuart Caie <kyzer@cabextract.org.uk>
#+
#+	* chmd.c: fixed an off-by-one error in the TOLOWER() macro, reported
#+	by Dmitry Glavatskikh. Thanks Dmitry!
#+
# 2017-11-26  Stuart Caie <kyzer@cabextract.org.uk>
# 
# 	* kwajd_read_headers(): fix up the logic of reading the filename and
Index: libmspack-0.6/mspack/chmd.c
===================================================================
--- libmspack-0.6.orig/mspack/chmd.c
+++ libmspack-0.6/mspack/chmd.c
@@ -834,7 +834,7 @@ static int search_chunk(struct mschmd_he
 # endif
 # define TOLOWER(x) tolower(x)
 #else
-# define TOLOWER(x) (((x)<0||(x)>256)?(x):mspack_tolower_map[(x)])
+# define TOLOWER(x) (((x)<0||(x)>255)?(x):mspack_tolower_map[(x)])
 /* Map of char -> lowercase char for the first 256 chars. Generated with:
  * LC_CTYPE=en_GB.utf-8 perl -Mlocale -le 'print map{ord(lc chr).","} 0..255'
  */
