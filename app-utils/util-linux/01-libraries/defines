PKGNAME=util-linux-runtime
PKGSEC=utils
PKGDES="Utilities and management tools for Linux (runtime libraries)"
PKGDEP="cryptsetup"
# We need the full dependency to build binaries.
BUILDDEP="asciidoctor coreutils file libcap-ng libeconf libutempter python-3 slang \
          systemd zlib"
BUILDDEP__RETRO=""
BUILDDEP__ARMV4="${BUILDDEP__RETRO}"
BUILDDEP__ARMV6HF="${BUILDDEP__RETRO}"
BUILDDEP__ARMV7HF="${BUILDDEP__RETRO}"
BUILDDEP__I486="${BUILDDEP__RETRO}"
BUILDDEP__LOONGSON2F="${BUILDDEP__RETRO}"
BUILDDEP__M68K="${BUILDDEP__RETRO}"
BUILDDEP__POWERPC="${BUILDDEP__RETRO}"
BUILDDEP__PPC64="${BUILDDEP__RETRO}"

# FIXME: raw(8) is no longer available as of Linux API headers 5.14.
#
# Ref: https://src.fedoraproject.org/rpms/util-linux/blob/rawhide/f/util-linux.spec#_965
#
# Ref: Commit in torvalds/linux.git ...
#      https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=603e4922f1c81fc2ed3a87b4f91a8d3aafc7e093
#
# Disable raw for all architectures, because linux/raw.h was deprecated since commit:
# 603e4922f1c81fc2ed3a87b4f91a8d3aafc7e093.
#
# Note: --without-user, libuser is needed for remote chsh, but we don't ship
# chsh from this package.
#
# FIXME: --disable-poman, this feature requires po4a but references a non-
# existent po4a.cfg in the build routine.
#
# Note: chfn, chsh, login, nologin, su and vipw are provided by shadow.
#
# Note: line was a demo provided by Mesa, which displays a triangle. `line' is
# not enabled in other distros.
#
# Note: --disable-hwclock-cmos, the Linux Kernel provides the necessary
# interface for access to the hardware clock.
AUTOTOOLS_AFTER="--localstatedir=/run \
                 --disable-werror \
                 --disable-asan \
                 --disable-ubsan \
                 --disable-fuzzing-engine \
                 --enable-symvers \
                 --enable-largefile \
                 --enable-assert \
                 --enable-nls \
                 --disable-rpath \
                 --enable-asciidoc \
                 --disable-poman \
                 --enable-tls \
                 --enable-widechar \
                 --enable-libuuid \
                 --enable-libuuid-force-uuidd \
                 --enable-libblkid \
                 --enable-libmount \
                 --enable-libsmartcols \
                 --enable-libfdisk \
                 --enable-fdisks \
                 --enable-mount \
                 --enable-losetup \
                 --enable-zramctl \
                 --enable-fsck \
                 --enable-partx \
                 --enable-uuidd \
                 --enable-uuidgen \
                 --enable-blkid \
                 --enable-wipefs \
                 --enable-mountpoint \
                 --enable-fallocate \
                 --enable-unshare \
                 --enable-nsenter \
                 --enable-setpriv \
                 --enable-hardlink \
                 --enable-eject \
                 --enable-agetty \
                 --enable-plymouth_support \
                 --enable-cramfs \
                 --enable-bfs \
                 --enable-minix \
                 --enable-fdformat \
                 --enable-hwclock \
                 --disable-hwclock-cmos \
                 --enable-hwclock-gplv3 \
                 --enable-mkfs \
                 --enable-fstrim \
                 --enable-swapon \
                 --enable-lscpu \
                 --enable-lsfd \
                 --enable-lslogins \
                 --enable-wdctl \
                 --enable-cal \
                 --enable-logger \
                 --enable-whereis \
                 --enable-switch_root \
                 --enable-pivot_root \
                 --enable-lsmem \
                 --enable-chmem \
                 --enable-ipcmk \
                 --enable-ipcrm \
                 --enable-ipcs \
                 --enable-irqtop \
                 --enable-lsirq \
                 --enable-lsns \
                 --enable-rfkill \
                 --enable-scriptutils \
                 --enable-tunelp \
                 --enable-kill \
                 --enable-last \
                 --enable-utmpdump \
                 --disable-line \
                 --enable-mesg \
                 --disable-raw \
                 --enable-rename \
                 --disable-vipw \
                 --disable-newgrp \
                 --disable-chfn-chsh-password \
                 --disable-chfn-chsh \
                 --disable-chsh-only-listed \
                 --disable-login \
                 --disable-login-chown-vcs \
                 --disable-login-stat-mail \
                 --disable-nologin \
                 --enable-sulogin \
                 --disable-su \
                 --enable-runuser \
                 --enable-ul \
                 --enable-more \
                 --enable-pg \
                 --enable-setterm \
                 --enable-schedutils \
                 --enable-wall \
                 --enable-write \
                 --enable-bash-completion \
                 --enable-pylibmount \
                 --enable-pg-bell \
                 --enable-fs-paths-default=/usr/bin \
                 --enable-use-tty-group \
                 --disable-sulogin-emergency-mount \
                 --enable-usrdir-path \
                 --enable-makeinstall-chown \
                 --enable-makeinstall-setuid \
                 --enable-colors-default \
                 --with-util \
                 --without-selinux \
                 --without-audit \
                 --with-udev \
                 --with-ncursesw \
                 --without-ncurses \
                 --with-slang \
                 --with-tinfo \
                 --with-readline \
                 --with-utempter \
                 --with-cap-ng \
                 --with-libz \
                 --with-libmagic \
                 --without-user \
                 --with-btrfs \
                 --with-systemd \
                 --without-smack \
                 --without-econf \
                 --with-python=3 \
                 --with-cryptsetup"
AUTOTOOLS_AFTER__RETRO=" \
                 ${AUTOTOOLS_AFTER} \
                 --without-python \
                 --disable-asciidoc \
                 --disable-pylibmount"

PKGREP="util-linux<=2.39.3-2"
PKGBREAK="util-linux<=2.39.3-2"
